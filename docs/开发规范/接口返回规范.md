# 接口返回规范

## 统一响应格式

```json
{ "code": 200, "msg": "操作成功", "data": { } }
```

## Controller 方法返回速查

| 方法 | 返回方式 | 响应 data |
|------|----------|-----------|
| index | `$this->respondWithPagination($records, Resource::class)` | `{ "list": [], "total": n }` |
| store | `$this->success(Resource::make($model)->toArray($request), '创建成功')` | 新建记录 |
| show | `$this->respondWithResource($model, Resource::class)` | 记录详情 |
| update | `$this->success(Resource::make($model)->toArray($request), '更新成功')` | 更新后记录 |
| destroy | `$this->success(null, '删除成功')` | `null` |

## 代码模板

### index (列表)
```php
public function index(Request $request): JsonResponse
{
    $params = $request->only(['筛选参数...', 'per_page', 'page']);
    $perPage = $this->resolvePerPage($params);
    $records = Model::filter($params)->with(['relation'])->orderBy('created_at', 'desc')->paginate($perPage);
    return $this->respondWithPagination($records, ModelResource::class);
}
```

### store (创建)
```php
public function store(ModelStoreRequest $request): JsonResponse
{
    $data = $request->validated();
    $model = new Model($data);
    $model->company_id = $data['company_id'];  // 不在 fillable 的字段单独设置
    $model->save();
    $model->load(['relation']);
    return $this->success(ModelResource::make($model)->toArray($request), '创建成功');
}
```

### show (详情)
```php
public function show(Request $request, Model $model): JsonResponse
{
    $model->load(['relation']);
    return $this->respondWithResource($model, ModelResource::class);
}
```

### update (更新)
```php
public function update(ModelUpdateRequest $request, Model $model): JsonResponse
{
    $model->update($request->validated());
    $model->refresh()->load(['relation']);
    return $this->success(ModelResource::make($model)->toArray($request), '更新成功');
}
```

### destroy (删除)
```php
public function destroy(Model $model): JsonResponse
{
    $model->delete();
    return $this->success(null, '删除成功');
}
```

## ❌ 禁止做法

```php
// ❌ 不使用 respondWithPagination
return $this->success(ModelResource::collection($records));

// ❌ 不使用 Resource::make()->toArray()
return $this->success(new ModelResource($model));

// ❌ 不使用 respondWithResource
return $this->success(new ModelResource($model));
```
